<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>××–×”×¨×•×ª ××¡×¢ âœˆï¸</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #cce7ff;
      margin: 0;
      padding: 0;
      color: #333;
    }

    header {
      text-align: center;
      padding: 30px 20px 10px;
      font-size: 2.2em;
      font-weight: bold;
      color: #004080;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    /* ğŸ” ×©×•×¨×ª ×—×™×¤×•×© */
    .search-box {
      width: 100%;
      padding: 14px;
      font-size: 1.1em;
      border-radius: 8px;
      border: 1px solid #999;
      outline: none;
    }

    .suggestions {
      background: #fff;
      border-radius: 8px;
      margin-top: 5px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      overflow: hidden;
    }

    .suggestion {
      padding: 10px;
      cursor: pointer;
    }

    .suggestion:hover {
      background: #e6f2ff;
    }

    /* ğŸ“„ ×ª×•×¦××” */
    .result-box {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      line-height: 1.6;
      font-size: 1em;
      white-space: pre-line;
      color: #000;
    }

    /* ğŸ¨ ×¦×‘×¢×™× ×œ×¤×™ ×¨××ª ××™×•× */
    .level-1 { background: #b9f6ca; }
    .level-2 { background: #ffe082; }
    .level-3 { background: #ffccbc; }
    .level-4-ban { background: #000; color: #fff; }
    .level-4-avoid { background: #ff8a80; }

    .combined-low { background: linear-gradient(135deg, #b9f6ca, #ffe082); }
    .combined-mid { background: linear-gradient(135deg, #ffe082, #ff8a80); }
    .combined-high { background: linear-gradient(135deg, #ff8a80, #d32f2f); }

    /* ğŸ”¹ ××™×™×§×•× ×™× ×¦×¤×™× */
    .social-floating {
      position: fixed;
      bottom: 20px;
      left: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 9999;
    }

    .social-floating img {
      width: 48px;
      height: 48px;
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 4px 10px rgba(0,0,0,0.25);
      transition: transform 0.2s;
    }

    .social-floating img:hover {
      transform: scale(1.1);
    }
  </style>
</head>

<body>

<header>××–×”×¨×•×ª ××¡×¢ ×œ×¤×™ ××“×™× ×” âœˆï¸</header>

<div class="container">
  <input
    type="text"
    id="search"
    class="search-box"
    placeholder="×”×§×œ×“ ×©× ××“×™× ×”â€¦"
    autocomplete="off"
  />

  <div id="suggestions" class="suggestions"></div>
  <div id="result"></div>
</div>

<!-- ğŸ”¹ ××™×™×§×•× ×™× ×¦×¤×™× -->
<div class="social-floating">
  <a href="https://t.me/AviationNewsIL" target="_blank">
    <img src="telegram_1.png" alt="Telegram">
  </a>
  <a href="https://whatsapp.com/channel/0029VaxalrjADTO95pRvmp3D" target="_blank">
    <img src="whatsapp_1.png" alt="WhatsApp">
  </a>
</div>

<script>
  const API_URL =
    "https://data.gov.il/api/3/action/datastore_search?resource_id=2a01d234-b2b0-4d46-baa0-cec05c401e7d&limit=5000";

  let records = [];

  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      records = data.result.records.filter(r => r["××©×¨×“"] === "××œ\"×œ");
    });

  const searchInput = document.getElementById("search");
  const suggestionsDiv = document.getElementById("suggestions");
  const resultDiv = document.getElementById("result");

  searchInput.addEventListener("input", () => {
    let value = searchInput.value.replace(/[^×-×ª\s]/g, "");
    searchInput.value = value;

    suggestionsDiv.innerHTML = "";
    resultDiv.innerHTML = "";

    if (!value) return;

    const matches = records
      .map(r => r.country)
      .filter(c => c.startsWith(value))
      .sort()
      .slice(0, 5);

    if (!matches.length) {
      showNoResults();
      return;
    }

    matches.forEach(country => {
      const div = document.createElement("div");
      div.className = "suggestion";
      div.textContent = country;
      div.onclick = () => selectCountry(country);
      suggestionsDiv.appendChild(div);
    });
  });

  function selectCountry(country) {
    suggestionsDiv.innerHTML = "";
    searchInput.value = country;

    const record = records.find(r => r.country === country);
    if (!record || !record.recommendations) {
      showNoResults();
      return;
    }

    const text = formatRecommendations(record.recommendations);
    const levelClass = detectLevel(record.recommendations);

    resultDiv.className = "result-box " + levelClass;
    resultDiv.textContent = text;
  }

  function showNoResults() {
    resultDiv.className = "result-box level-1";
    resultDiv.textContent =
      "××™×Ÿ ×ª×•×¦××•×ª, × ×™×ª×Ÿ ×œ×‘×§×¨ ×‘××ª×¨ ×”××œ\"×œ ×œ×—×™×¤×•×© ××¢××™×§";
  }

  function detectLevel(text) {
    if (text.includes("×—×œ ××™×¡×•×¨ ×¢×œ × ×¡×™×¢×”")) return "level-4-ban";
    if (text.includes("×œ×”×™×× ×¢ ××”×’×¢×”")) return "level-4-avoid";

    const levels = [...text.matchAll(/×¨××”\s*(\d)/g)].map(m => parseInt(m[1]));
    if (levels.length > 1) {
      const max = Math.max(...levels);
      if (max <= 2) return "combined-low";
      if (max === 3) return "combined-mid";
      return "combined-high";
    }

    if (text.includes("×¨××” 3")) return "level-3";
    if (text.includes("×¨××” 2")) return "level-2";
    return "level-1";
  }

  function formatRecommendations(text) {
    let formatted = text.trim();

    formatted = formatted.replace(
      /×¨××ª ××™×•× ××©×•×œ×‘×ª:\s*/g,
      "×¨××ª ××™×•× ××©×•×œ×‘×ª:\n"
    );

    formatted = formatted.replace(
      /\. (×¨××”\s*\d|×œ×œ× ××–×”×¨×ª ××¡×¢)/g,
      ".\n$1"
    );

    return formatted;
  }
</script>

</body>
</html>
